# This workflow will build a golang project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-go

name: Workflow curso de ci

on:
    push:
        branches: [ "devops-ci" ]
    pull_request:
        branches: [ "main" ]
    
jobs:
    test:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v3

        - name: Set up Go
          uses: actions/setup-go@v3
          with:
            go-version: 1.18

        - name: Build-DB
          working-directory: devops/ci/projeto-go-testes-main
          run: docker-compose build

        - name: Create-DB
          working-directory: devops/ci/projeto-go-testes-main
          run: docker-compose up -d

        - name: Test
          working-directory: devops/ci/projeto-go-testes-main
          run: go test -v main_test.go

    build:
        needs: test
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v3

        - name: Build
          working-directory: devops/ci/projeto-go-testes-main
          run: go build -v main.go
